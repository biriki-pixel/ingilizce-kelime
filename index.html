<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Ä°ngilizce Kelime Oyunu</title>
<style>
body{font-family:Arial;background:#f4f7fb;text-align:center;padding:20px}
.hidden{display:none}
.panel{background:#fff;padding:15px;border-radius:10px;max-width:500px;margin:auto}
button{padding:10px 20px;font-size:18px;margin:5px}
.option{display:block;width:60%;margin:10px auto}
.correct{background:#4caf50;color:#fff}
.wrong{background:#f44336;color:#fff}
</style>
</head>

<body>

<h1>ğŸ§’ Ä°ngilizce Kelime Oyunu</h1>

<!-- MENU -->
<div id="menu" class="panel">
  <h3>ğŸ”¢ Soru SayÄ±sÄ±</h3>
  <select id="limitSelect">
    <option value="25">25</option>
    <option value="35">35</option>
    <option value="50">50</option>
  </select>
  <br><br>
  <button onclick="startGame()">â–¶ï¸ BaÅŸla</button>
</div>

<!-- QUIZ -->
<div id="quiz" class="panel hidden">
  <div id="counter"></div>
  <h2 id="question"></h2>
  <div id="options"></div>
  <div id="emoji"></div>
</div>

<!-- STATS -->
<div id="stats" class="panel hidden">
  <h2>ğŸ“Š Oyun Sonu</h2>
  <p id="statsText"></p>
  <button onclick="startGame()">â–¶ï¸ Tekrar BaÅŸla</button>
  <button onclick="goMenu()">ğŸ  MenÃ¼</button>
</div>

<!-- PARENT -->
<div id="parent" class="panel hidden">
  <h2>ğŸ” Ebeveyn Paneli</h2>
  <input id="pin" type="password" placeholder="PIN (1234)">
  <button onclick="checkPin()">GiriÅŸ</button>

  <div id="parentPanel" class="hidden">
    <input id="en" placeholder="English">
    <input id="tr" placeholder="TÃ¼rkÃ§e">
    <button onclick="addWord()">Kelime Ekle</button>
    <br><br>
    <button onclick="goMenu()">â¬…ï¸ MenÃ¼</button>
  </div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* ğŸ”¥ FIREBASE CONFIG â€” BURAYA KENDÄ° BÄ°LGÄ°NÄ° KOY */
const firebaseConfig = {
  apiKey: "AIzaSyB8n3un1uE6TK-9actPFldoFjjIcOMA94c",
  authDomain: "kelimeler-2405a.firebaseapp.com",
  databaseURL: "https://kelimeler-2405a-default-rtdb.firebaseio.com",
  projectId: "kelimeler-2405a",
  storageBucket: "kelimeler-2405a.appspot.com",
  messagingSenderId: "379474976160",
  appId: "1:379474976160:web:e888b63af4f5d871af58c5",
  measurementId: "G-FM3L80E3FE"
};
const db = firebase.firestore();

/* DATA */
let words=[], progress=JSON.parse(localStorage.getItem("progress"))||{};
let limit=25,count=0,correct=0,wrong=0,current;

/* ROUTE */
function route(){
  hideAll();
  if(location.pathname.endsWith("/panel")) parent.classList.remove("hidden");
  else menu.classList.remove("hidden");
}
window.onpopstate=route;

/* LOAD WORDS */
db.collection("words").onSnapshot(snap=>{
  words=snap.docs.map(d=>d.data());
});

/* GAME */
function startGame(){
  limit=+limitSelect.value;
  count=correct=wrong=0;
  hideAll();quiz.classList.remove("hidden");
  next();
}

function next(){
  if(count>=limit) return statsShow();
  let pool=words.filter(w=>!progress[w.en]?.done);
  if(!pool.length) return statsShow();
  current=pool[Math.floor(Math.random()*pool.length)];
  count++;

  let askEn=Math.random()>0.5;
  let q=askEn?current.en:current.tr;
  let a=askEn?current.tr:current.en;

  let opts=[a];
  while(opts.length<3){
    let w=words[Math.floor(Math.random()*words.length)];
    let o=askEn?w.tr:w.en;
    if(!opts.includes(o)) opts.push(o);
  }
  opts.sort(()=>Math.random()-0.5);

  counter.innerText=`Soru ${count}/${limit}`;
  question.innerText=q;emoji.innerText="";
  options.innerHTML="";
  opts.forEach(o=>{
    let b=document.createElement("button");
    b.className="option";b.innerText=o;
    b.onclick=()=>check(o,a);
    options.appendChild(b);
  });
}

function check(sel,ans){
  document.querySelectorAll(".option").forEach(b=>{
    if(b.innerText===ans)b.classList.add("correct");
    if(b.innerText===sel&&sel!==ans)b.classList.add("wrong");
    b.disabled=true;
  });

  progress[current.en]=progress[current.en]||{correct:0};
  if(sel===ans){
    correct++;emoji.innerText="ğŸ‰";
    progress[current.en].correct++;
    if(progress[current.en].correct>=5)progress[current.en].done=true;
  }else{wrong++;emoji.innerText="ğŸ˜…"}
  save();setTimeout(next,1500);
}

function statsShow(){
  hideAll();stats.classList.remove("hidden");
  let learned=Object.values(progress).filter(p=>p.done).length;
  statsText.innerHTML=
    `âœ… DoÄŸru: ${correct}<br>
     âŒ YanlÄ±ÅŸ: ${wrong}<br>
     ğŸ§  Ã–ÄŸrenilen: ${learned}`;
}

/* PARENT */
function checkPin(){
  if(pin.value==="1234")parentPanel.classList.remove("hidden");
  else alert("YanlÄ±ÅŸ PIN");
}
function addWord(){
  if(!en.value||!tr.value)return;
  db.collection("words").add({en:en.value,tr:tr.value});
  en.value=tr.value="";
}

/* UTIL */
function save(){
  localStorage.setItem("progress",JSON.stringify(progress));
}
function goMenu(){
  history.pushState({},"","/");
  route();
}
function hideAll(){
  document.querySelectorAll(".panel").forEach(p=>p.classList.add("hidden"));
}
route();
</script>

</body>
</html>
