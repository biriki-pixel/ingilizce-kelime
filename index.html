<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Ä°ngilizce Kelime Oyunu</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f7fb;
  text-align: center;
  padding: 20px;
}
.hidden { display:none; }
button {
  padding: 10px 20px;
  margin: 5px;
  font-size: 18px;
  cursor: pointer;
}
.option {
  display: block;
  width: 60%;
  margin: 10px auto;
}
.correct { background:#4caf50; color:#fff; }
.wrong { background:#f44336; color:#fff; }
#emoji { font-size:40px; }
.panel {
  background:#fff;
  padding:15px;
  border-radius:10px;
  max-width:500px;
  margin:auto;
}
#secret {
  font-size:30px;
  cursor:pointer;
  user-select:none;
}
</style>
</head>

<body>

<h1>ğŸ§’ Ä°ngilizce Kelime Oyunu</h1>

<!-- BAÅLANGIÃ‡ -->
<div id="menu" class="panel">
  <div id="secret" title="Ebeveyn" onclick="goPanel()">ğŸ™‚</div>

  <h3>ğŸ”¢ Soru SayÄ±sÄ±</h3>
  <select id="limitSelect">
    <option value="25">25</option>
    <option value="35">35</option>
    <option value="50">50</option>
  </select>

  <br><br>
  <button onclick="startGame()">â–¶ï¸ BaÅŸla</button>
</div>

<!-- OYUN -->
<div id="quiz" class="panel hidden">
  <div id="counter"></div>
  <h2 id="question"></h2>
  <div id="options"></div>
  <div id="emoji"></div>
</div>

<!-- Ä°STATÄ°STÄ°K -->
<div id="stats" class="panel hidden">
  <h2>ğŸ“Š Oyun Sonu</h2>
  <p id="statsText"></p>
  <button onclick="restart()">â–¶ï¸ Tekrar BaÅŸla</button>
  <button onclick="goMenu()">ğŸ  MenÃ¼</button>
</div>

<!-- EBEVEYN PANELÄ° -->
<div id="parent" class="panel hidden">
  <h2>ğŸ” Ebeveyn Paneli</h2>
  <input id="pin" type="password" placeholder="PIN (1234)">
  <button onclick="checkPin()">GiriÅŸ</button>

  <div id="parentPanel" class="hidden">
    <h3>â• Kelime Ekle</h3>
    <input id="en" placeholder="English">
    <input id="tr" placeholder="TÃ¼rkÃ§e">
    <button onclick="addWord()">Ekle</button>
    <br><br>
    <button onclick="goMenu()">â¬…ï¸ MenÃ¼</button>
  </div>
</div>

<audio id="clap">
  <source src="https://www.soundjay.com/human/applause-8.mp3">
</audio>

<script>
/* ===== DATA ===== */
let words = JSON.parse(localStorage.getItem("words")) || [
  {en:"apple", tr:"elma"},
  {en:"cat", tr:"kedi"},
  {en:"book", tr:"kitap"}
];
let progress = JSON.parse(localStorage.getItem("progress")) || {};
let limit = 25;
let count = 0, correctTotal = 0, wrongTotal = 0;
let current;

/* ===== ROUTING ===== */
function route() {
  hideAll();
  if (location.pathname.endsWith("/panel")) {
    document.getElementById("parent").classList.remove("hidden");
  } else {
    document.getElementById("menu").classList.remove("hidden");
  }
}
window.onpopstate = route;

/* ===== NAV ===== */
function goPanel() {
  history.pushState({}, "", "panel");
  route();
}
function goMenu() {
  history.pushState({}, "", "./");
  route();
}

/* ===== GAME ===== */
function startGame() {
  limit = parseInt(document.getElementById("limitSelect").value);
  count = correctTotal = wrongTotal = 0;
  hideAll();
  document.getElementById("quiz").classList.remove("hidden");
  nextQuestion();
}

function nextQuestion() {
  if (count >= limit) return showStats();

  let pool = words.filter(w => !(progress[w.en]?.done));
  if (!pool.length) return showStats();

  current = pool[Math.floor(Math.random()*pool.length)];
  count++;

  let askEn = Math.random() > 0.5;
  let question = askEn ? current.en : current.tr;
  let answer = askEn ? current.tr : current.en;

  let options = [answer];
  while (options.length < 3) {
    let w = words[Math.floor(Math.random()*words.length)];
    let o = askEn ? w.tr : w.en;
    if (!options.includes(o)) options.push(o);
  }
  options.sort(()=>Math.random()-0.5);

  document.getElementById("counter").innerText = `Soru: ${count}/${limit}`;
  document.getElementById("question").innerText = question;
  document.getElementById("emoji").innerText = "";

  let optDiv = document.getElementById("options");
  optDiv.innerHTML = "";
  options.forEach(o=>{
    let b=document.createElement("button");
    b.className="option";
    b.innerText=o;
    b.onclick=()=>check(o,answer);
    optDiv.appendChild(b);
  });
}

function check(sel, ans) {
  document.querySelectorAll(".option").forEach(b=>{
    if (b.innerText===ans) b.classList.add("correct");
    if (b.innerText===sel && sel!==ans) b.classList.add("wrong");
    b.disabled=true;
  });

  progress[current.en]=progress[current.en]||{correct:0};

  if (sel===ans) {
    correctTotal++;
    progress[current.en].correct++;
    document.getElementById("emoji").innerText="ğŸ‰ğŸ‘";
    document.getElementById("clap").play();
    if (progress[current.en].correct>=5) progress[current.en].done=true;
  } else {
    wrongTotal++;
    document.getElementById("emoji").innerText="ğŸ˜…";
  }

  save();
  setTimeout(nextQuestion,1500);
}

function showStats() {
  hideAll();
  document.getElementById("stats").classList.remove("hidden");
  let learned = Object.values(progress).filter(p=>p.done).length;
  document.getElementById("statsText").innerHTML =
    `âœ… DoÄŸru: ${correctTotal}<br>
     âŒ YanlÄ±ÅŸ: ${wrongTotal}<br>
     ğŸ§  Ã–ÄŸrenilen kelime: ${learned}`;
}

function restart(){ startGame(); }

/* ===== PARENT ===== */
function checkPin(){
  if (document.getElementById("pin").value==="1234")
    document.getElementById("parentPanel").classList.remove("hidden");
  else alert("YanlÄ±ÅŸ PIN");
}

function addWord(){
  let en=document.getElementById("en").value.trim();
  let tr=document.getElementById("tr").value.trim();
  if(!en||!tr)return;
  words.push({en,tr});
  save();
  alert("Kelime eklendi");
}

/* ===== UTIL ===== */
function save(){
  localStorage.setItem("words",JSON.stringify(words));
  localStorage.setItem("progress",JSON.stringify(progress));
}
function hideAll(){
  document.querySelectorAll(".panel").forEach(p=>p.classList.add("hidden"));
}

/* INIT */
route();
</script>

</body>
</html>
